<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Área do Candidato - Etec</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="estilo-unidade-e-curso.css">
</head>

<body>
    <div class="fundo">

        <header class="top-header">
            <div class="container-fluid d-flex align-items-center justify-content-between py-3">
                <div class="caixa-gov d-flex align-items-center">
                    <img src="images-removebg-preview.png" alt="Logo Governo" class="logo-gov">
                </div>

                <div class="flex-fill"></div>

                <div class="redes-wrap d-flex align-items-center">
                    <img src="redes.jfif" alt="Redes" class="redes-logo">
                </div>
            </div>

            <div class="linha"></div>
        </header>

        <div class="caixa-fixa">
            <div class="container-fluid d-flex align-items-center justify-content-between py-2">
                <div class="d-flex align-items-center">
                    <img src="etec_cps-removebg-preview.png" alt="Etec" class="logo-etec-cps">
                </div>

                <nav class="main-nav">
                    <ul class="nav list-unstyled d-flex gap-4 mb-0">
                        <li><a class="nav-link" href="#">HOME</a></li>
                        <li><a class="nav-link" href="#">CALENDÁRIO</a></li>
                        <li><a class="nav-link" href="#">DÚVIDAS FREQUENTES</a></li>
                        <li><a class="nav-link" href="#">FALE CONOSCO</a></li>
                    </ul>
                </nav>

                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-danger btn-sm btn-area d-flex align-items-center gap-2 px-3" aria-label="Área do Candidato">
                        Área do candidato
                        <img src="image-removebg-preview.png" width="20" alt="Ícone de área do candidato">
                    </button>

                    <div class="bloco">
                        <div class="realizacao">
                            <span>Realização:</span>
                            <img src="FAT-FUNDACAO-DE-APOIO-A-TECNOLOGIA.webp" alt="FAT" class="realizacao-logo">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section class="imagem-banner">
            <img src="highlight-bg.jpg" alt="Imagem destaque" class="img-fluid w-100">
        </section>

        <main class="container py-5">
            <div class="vermelho">
                <div class="vermelho-word">Inscrição</div>
            </div>
            <div class="conteudo">
                <div class="cinza"></div>
                <div class="cinza-plus"></div>
                <div class="container-botoes">

                    <div class="grupo">
                        <button class="btn-circular">✓</button>
                        <span class="labele">Dados de acesso</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular ativo">2</button>
                        <span class="labele">Unidade e curso</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular">3</button>
                        <span class="labele">Dados pessoais</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular">4</button>
                        <span class="labele">Pont. acrescida</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular">5</button>
                        <span class="labele">Confirmação</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular">6</button>
                        <span class="labele">Questionário</span>
                    </div>

                    <div class="grupo">
                        <button class="btn-circular">7</button>
                        <span class="labele">Conclusão</span>
                    </div>

                </div>
                <p class="palavras">
                    Para iniciar a inscrição para Processo Seletivo Vestibulinho 1º semestre de 2026 selecione abaixo o município da Etec / Extensão de Etec em que pretende estudar.
                </p>

                <div class="row d-flex justify-content-center">
                    <div class="col-12 col-lg-10">
                        <form id="form-inscricao" action="dados-pessoais.html" method="GET">
                            <label class="form-label bloco-titulo d-block">O candidato é treineiro?</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="treineiro" id="nao" value="Nao" checked>
                                <label class="form-check-label" for="nao">Não</label>
                            </div>
                            <div class="form-check form-check-inline mb-4">
                                <input class="form-check-input" type="radio" name="treineiro" id="sim" value="Sim">
                                <label class="form-check-label" for="sim">Sim</label>
                            </div>

                            <p class="text-secondary mb-4" style="font-size: 14px; padding: 10px; border-left: 3px solid #b10505;">
                                Treineiro é um estudante que ainda não tem os requisitos de ingresso para o Ensino Médio (não irá concluir o ensino fundamental no final de 2025) e deseja participar do exame do Vestibulinho, para ganhar experiência com o formato da prova, familiarizar-se com o ambiente e testar seus conhecimentos, o que o ajuda a se preparar para futuras provas que realmente contarão para sua aprovação.
                            </p>

                            <label class="form-label bloco-titulo">Município da Etec / Extensão de Etec</label>
                            <select class="form-select mb-4 campo-select" id="municipio" required>
                                <option value="" selected disabled>Carregando municípios...</option>
                            </select>

                            <div id="bloco-curso-detalhado" style="display: block;">
                                <label class="form-label bloco-titulo">Modalidade</label>
                                <select class="form-select mb-3 campo-select" id="modalidade">
                                    <option value="" selected disabled>Selecione a modalidade de ensino desejada</option>
                                    <option value="ensino-medio">Ensino Médio</option>
                                    <option value="ensino-medio-integrado">Ensino Médio Integrado</option>
                                    <option value="ensino-medio-eja">Ensino Médio - EJA</option>
                                    <option value="tecnico-integrado">Curso Técnico Integrado</option>
                                    <option value="tecnico-subsequente">Curso Técnico Subsequente</option>
                                    <option value="tecnico-concomitante">Curso Técnico Concomitante</option>
                                </select>
                                <p class="text-danger mb-4" style="font-size: 12px; margin-top: -8px; padding-left: 10px;"><img src="image-removebg-preview.png" width="10" alt=""></p>

                                <label class="form-label bloco-titulo">Curso e período</label>
                                <select class="form-select mb-3 campo-select" id="curso-periodo">
                                    <option value="" selected disabled>Selecione primeiro a modalidade</option>
                                </select>
                                <div class="alert alert-warning mb-4" style="font-size: 14px; padding: 10px;">
                                    Selecione a unidade
                                </div>

                                <h3 class="mb-3 mt-4" style="font-size:20px; font-weight:600; color:#444;">2ª opção</h3>
                                <label class="form-label bloco-titulo">Selecione a 2ª opção de curso e período que pretende estudar.</label>
                                <select class="form-select mb-4 campo-select" id="segunda-opcao">
                                    <option value="" selected disabled>Selecione primeiro a modalidade</option>
                                </select>

                                <h3 class="mb-3 mt-4" style="font-size:20px; font-weight:600; color:#444;">Confirmação de pré-requisitos</h3>
                                <label class="form-label bloco-titulo d-block">1. Você já concluiu o Ensino Médio ou está matriculado na 3ª série do Ensino Médio no ano de 2025?<span class="text-danger">*</span></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="prerequisito" id="prerequisito_sim" value="Sim">
                                    <label class="form-check-label" for="prerequisito_sim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="prerequisito" id="prerequisito_nao" value="Nao">
                                    <label class="form-check-label" for="prerequisito_nao">Não</label>
                                </div>
                            </div>

                            <div class="action-row mt-4">
                                <button class="btn-primary-custom" formaction="dados-pessoais.html" type="submit">Salvar e ir para a próxima etapa</button>
                                <button class="btn-secondary-custom" type="button">Sair e continuar inscrição depois</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="conteudo-red"></div>
        </div>
        </main>

    </div>

    <footer class="footer">
        <div class="footer-tops"></div>

        <div class="footer-top">
            <p><a href="#">Todos os direitos reservados © 2025 FAT | </a>
                <a href="#">Política de Privacidade | </a>
                <a href="#">Termos de Uso</a>
            </p>
        </div>

        <div class="footer-mid">
            <img src="Captura_de_tela_2025-11-15_161028-removebg-preview.png" alt="atg" class="atge">
        </div>

        <div class="footer-buttons">
            <a class="btn-footer">Ouvidoria</a>
            <a class="btn-footer">Transparência</a>
            <a class="btn-footer">SIC</a>
        </div>

        <div class="footer-bottom">
            <img src="images-removebg-preview.png" alt="Governo de SP">
        </div>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
       document.addEventListener("DOMContentLoaded", async () => {
    const sim = document.getElementById("sim");
    const nao = document.getElementById("nao");
    const bloco = document.getElementById("bloco-curso-detalhado");
    const municipioSelect = document.getElementById("municipio");
    const modalidadeSelect = document.getElementById("modalidade");
    const cursoPeriodoSelect = document.getElementById("curso-periodo");
    const segundaOpcaoSelect = document.getElementById("segunda-opcao");
    const alertUnidade = document.querySelector('.alert-warning');
    const form = document.getElementById("form-inscricao");
    const btnSair = document.querySelector(".btn-secondary-custom");

    // Dados mockados para quando a API falhar
    const DADOS_MOCK = {
        municipios: [
            "São Paulo", "Santos", "Campinas", "São Bernardo do Campo", 
            "São José dos Campos", "Ribeirão Preto", "Sorocaba", "Jundiaí",
            "Piracicaba", "Bauru", "São José do Rio Preto", "Mogi das Cruzes"
        ],
        etecs: [
            {
                name: "ETEC São Paulo",
                cidade: "São Paulo",
                cursos: [
                    { nome: "Ensino Médio", periodo: "Manhã" },
                    { nome: "Ensino Médio Integrado com Informática", periodo: "Tarde" },
                    { nome: "Técnico em Administração", periodo: "Noite" }
                ]
            },
            {
                name: "ETEC Santos",
                cidade: "Santos",
                cursos: [
                    { nome: "Ensino Médio", periodo: "Manhã" },
                    { nome: "Técnico em Logística", periodo: "Tarde" },
                    { nome: "Técnico em Turismo", periodo: "Noite" }
                ]
            },
            {
                name: "ETEC Campinas",
                cidade: "Campinas",
                cursos: [
                    { nome: "Ensino Médio", periodo: "Manhã" },
                    { nome: "Ensino Médio Integrado com Mecatrônica", periodo: "Integral" },
                    { nome: "Técnico em Eletrônica", periodo: "Noite" }
                ]
            }
        ]
    };

    let todasEtecs = [];
    let municipiosDisponiveis = [];

    // Função para fazer requisições com fallback para dados mockados
    async function fazerRequisicao(endpoint) {
        const API_BASE = 'https://etecs-api.onrender.com';
        
        try {
            console.log(`Tentando conectar com: ${API_BASE}${endpoint}`);
            
            // Timeout de 5 segundos
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            const response = await fetch(`${API_BASE}${endpoint}`, {
                signal: controller.signal,
                headers: {
                    'Accept': 'application/json',
                }
            });
            
            clearTimeout(timeoutId);
            
            if (!response.ok) {
                throw new Error(`Erro HTTP: ${response.status}`);
            }
            
            return await response.json();
        } catch (error) {
            console.warn('API não disponível, usando dados mockados:', error.message);
            
            // Fallback para dados mockados
            if (endpoint === '/cidades') {
                return DADOS_MOCK.municipios;
            } else if (endpoint === '/etecs') {
                return DADOS_MOCK.etecs;
            } else if (endpoint.includes('/busca/cidade')) {
                const urlParams = new URLSearchParams(endpoint.split('?')[1]);
                const cidade = urlParams.get('cidade');
                return DADOS_MOCK.etecs.filter(etec => 
                    etec.cidade.toLowerCase().includes(cidade.toLowerCase())
                );
            }
            
            return [];
        }
    }

    // Carregar dados da API ou usar fallback
    async function carregarDados() {
        try {
            console.log('Tentando carregar dados da API...');
            
            // Carregar cidades
            municipiosDisponiveis = await fazerRequisicao('/cidades');
            console.log('Municípios carregados:', municipiosDisponiveis);
            
            // Carregar ETECs
            todasEtecs = await fazerRequisicao('/etecs');
            console.log('ETECs carregadas:', todasEtecs);

            return true;
        } catch (error) {
            console.error('Erro crítico ao carregar dados:', error);
            return false;
        }
    }

    // Popular select de municípios
    function carregarMunicipios() {
        municipioSelect.innerHTML = '<option value="" selected disabled>Carregando municípios...</option>';
        
        setTimeout(() => {
            if (!municipiosDisponiveis || municipiosDisponiveis.length === 0) {
                municipioSelect.innerHTML = '<option value="" selected disabled>Nenhum município disponível</option>';
                alertUnidade.textContent = 'Nenhum município disponível no momento';
                alertUnidade.className = 'alert alert-warning';
                return;
            }

            municipioSelect.innerHTML = '<option value="" selected disabled>Selecione o município da Etec</option>';
            
            municipiosDisponiveis.forEach(municipio => {
                const option = document.createElement("option");
                option.value = municipio;
                option.textContent = municipio;
                municipioSelect.appendChild(option);
            });

            alertUnidade.textContent = `${municipiosDisponiveis.length} municípios disponíveis`;
            alertUnidade.className = 'alert alert-info';
        }, 1000);
    }

    // Buscar ETECs por município
    async function buscarEtecsPorMunicipio(municipio) {
        try {
            console.log(`Buscando ETECs em: ${municipio}`);
            const etecs = await fazerRequisicao(`/busca/cidade?cidade=${encodeURIComponent(municipio)}`);
            console.log(`ETECs encontradas em ${municipio}:`, etecs);
            return etecs;
        } catch (error) {
            console.warn('Erro na busca por cidade, usando dados locais:', error);
            // Fallback para busca local nos dados já carregados
            return todasEtecs.filter(etec => 
                etec.cidade && etec.cidade.toLowerCase().includes(municipio.toLowerCase())
            );
        }
    }

    // Carregar cursos baseado na modalidade e município
    async function carregarCursos(modalidade, municipio) {
        console.log(`Carregando cursos: ${modalidade} em ${municipio}`);
        
        cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Carregando cursos...</option>';
        segundaOpcaoSelect.innerHTML = '<option value="" selected disabled>Carregando...</option>';
        alertUnidade.textContent = 'Buscando cursos...';
        alertUnidade.className = 'alert alert-info';

        try {
            if (!municipio) {
                cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Selecione primeiro o município</option>';
                alertUnidade.textContent = 'Selecione o município';
                alertUnidade.className = 'alert alert-warning';
                return;
            }

            const etecsMunicipio = await buscarEtecsPorMunicipio(municipio);
            
            if (etecsMunicipio.length === 0) {
                cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Nenhuma ETEC encontrada</option>';
                alertUnidade.textContent = `Nenhuma ETEC encontrada em ${municipio}`;
                alertUnidade.className = 'alert alert-danger';
                return;
            }

            // Coletar todos os cursos das ETECs encontradas
            let todosCursos = [];
            etecsMunicipio.forEach(etec => {
                if (etec.cursos && Array.isArray(etec.cursos)) {
                    etec.cursos.forEach(curso => {
                        if (curso.nome && curso.periodo) {
                            todosCursos.push({
                                nome: curso.nome,
                                periodo: curso.periodo,
                                etec: etec.name || 'ETEC'
                            });
                        }
                    });
                }
            });

            console.log(`Total de cursos encontrados em ${municipio}:`, todosCursos.length);

            // Filtrar por modalidade
            const cursosFiltrados = filtrarCursosPorModalidade(todosCursos, modalidade);
            console.log(`Cursos filtrados por ${modalidade}:`, cursosFiltrados.length);

            if (cursosFiltrados.length === 0) {
                cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Nenhum curso disponível</option>';
                alertUnidade.textContent = `Nenhum curso de ${modalidadeSelect.options[modalidadeSelect.selectedIndex].text} disponível em ${municipio}`;
                alertUnidade.className = 'alert alert-warning';
                return;
            }

            // Popular select de cursos
            cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Selecione o curso e período</option>';
            cursosFiltrados.forEach(curso => {
                const option = document.createElement("option");
                option.value = `${curso.nome}|${curso.periodo}|${curso.etec}`;
                option.textContent = `${curso.nome} - ${curso.periodo} (${curso.etec})`;
                cursoPeriodoSelect.appendChild(option);
            });

            alertUnidade.textContent = `${cursosFiltrados.length} curso(s) disponível(is) em ${municipio}`;
            alertUnidade.className = 'alert alert-success';
            
            // Carregar segunda opção
            carregarSegundaOpcao(cursosFiltrados);
        } catch (error) {
            console.error('Erro ao carregar cursos:', error);
            cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Erro ao carregar cursos</option>';
            alertUnidade.textContent = 'Erro ao carregar cursos. Tente novamente.';
            alertUnidade.className = 'alert alert-danger';
        }
    }

    function filtrarCursosPorModalidade(cursos, modalidade) {
        const modalidadeLower = modalidade.toLowerCase();
        
        return cursos.filter(curso => {
            const cursoLower = curso.nome.toLowerCase();
            
            if (modalidadeLower === "ensino-medio") {
                return cursoLower.includes("ensino médio") && !cursoLower.includes("integrado");
            } else if (modalidadeLower === "ensino-medio-integrado") {
                return cursoLower.includes("ensino médio") && cursoLower.includes("integrado");
            } else if (modalidadeLower === "ensino-medio-eja") {
                return cursoLower.includes("eja") || cursoLower.includes("educação de jovens");
            } else if (modalidadeLower === "tecnico-integrado") {
                return !cursoLower.includes("ensino médio") && cursoLower.includes("integrado");
            } else if (modalidadeLower === "tecnico-subsequente") {
                return !cursoLower.includes("ensino médio") && !cursoLower.includes("integrado") && cursoLower.includes("técnico");
            } else if (modalidadeLower === "tecnico-concomitante") {
                return !cursoLower.includes("ensino médio") && !cursoLower.includes("integrado") && cursoLower.includes("concomitante");
            }
            return false;
        });
    }

    function carregarSegundaOpcao(cursosDisponiveis) {
        segundaOpcaoSelect.innerHTML = '<option value="" selected disabled>Selecione a segunda opção</option>';
        
        const nenhumaOpcao = document.createElement("option");
        nenhumaOpcao.value = "nenhuma";
        nenhumaOpcao.textContent = "Nenhuma segunda opção";
        segundaOpcaoSelect.appendChild(nenhumaOpcao);

        cursosDisponiveis.forEach(curso => {
            const option = document.createElement("option");
            option.value = `${curso.nome}|${curso.periodo}|${curso.etec}`;
            option.textContent = `${curso.nome} - ${curso.periodo} (${curso.etec})`;
            segundaOpcaoSelect.appendChild(option);
        });
    }

    function atualizarVisibilidade() {
        bloco.style.display = sim.checked ? "none" : "block";
        if (sim.checked) {
            municipioSelect.value = "";
            modalidadeSelect.value = "";
            cursoPeriodoSelect.innerHTML = '<option value="" selected disabled>Selecione primeiro a modalidade</option>';
            segundaOpcaoSelect.innerHTML = '<option value="" selected disabled>Selecione primeiro a modalidade</option>';
            alertUnidade.textContent = 'Selecione a unidade';
            alertUnidade.className = 'alert alert-warning';
        } else {
            alertUnidade.textContent = 'Selecione o município e modalidade';
            alertUnidade.className = 'alert alert-info';
        }
    }

    // Event Listeners
    sim.addEventListener("change", atualizarVisibilidade);
    nao.addEventListener("change", atualizarVisibilidade);

    municipioSelect.addEventListener("change", () => {
        if (modalidadeSelect.value && municipioSelect.value) {
            carregarCursos(modalidadeSelect.value, municipioSelect.value);
        } else if (municipioSelect.value) {
            alertUnidade.textContent = 'Agora selecione a modalidade';
            alertUnidade.className = 'alert alert-info';
        }
    });

    modalidadeSelect.addEventListener("change", () => {
        if (municipioSelect.value && modalidadeSelect.value) {
            carregarCursos(modalidadeSelect.value, municipioSelect.value);
        } else if (modalidadeSelect.value) {
            alertUnidade.textContent = 'Agora selecione o município';
            alertUnidade.className = 'alert alert-info';
        }
    });

    btnSair.addEventListener("click", () => {
        if (confirm("Deseja realmente sair? Seus dados serão salvos temporariamente.")) {
            const temp = {
                treineiro: document.querySelector('input[name="treineiro"]:checked').value,
                municipio: municipioSelect.value,
                modalidade: modalidadeSelect.value,
                curso: cursoPeriodoSelect.value
            };
            localStorage.setItem("dadosTempUnidadeCurso", JSON.stringify(temp));
            window.location.href = "index.html";
        }
    });

    // Inicialização
    async function inicializar() {
        await carregarDados();
        carregarMunicipios();
        atualizarVisibilidade();
        
        // Mostrar status no console
        console.log('Aplicação inicializada com:', {
            municipios: municipiosDisponiveis.length,
            etecs: todasEtecs.length,
            usandoDadosMock: municipiosDisponiveis === DADOS_MOCK.municipios
        });
    }

    inicializar();
});
    </script>

</body>

</html>
